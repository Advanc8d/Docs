Инструкция по обновлению минорных версий miniShop2.

## Переход с 2.2 на 2.4

Главным отличием 2.4 от 2.2, которое может повлиять на функционал работающего сайта, является использование чанков [Fenom][1] **во всех сниппетах**.
Поэтому при обновлении компонента нужно **обязательно** обновить и свои чанки.

Общий смысл в том, что вместо 2-3 чанков вывода результатов, теперь используется один.

Например, раньше для оформления корзины требовалось 3 чанка:
- **tpl.msCart.outer** - заголовок и подвал таблицы товаров, в середине тег `[[+goods]]` для подстановки товаров
- **tpl.msCart.row** - чанк товаров, которые подставляются в `[[+goods]]`
- **tpl.msCart.empty** - чанк вывода пустой корзины

Целых 3 чанка для оформления одного сниппета само по себе не очень удобно, учитывая, что в ms2 уже **8 сниппетов**, да еще и обработка каждого товара отдельно занимает лишнее время.

Раньше с этим ничего поделать было нельзя, но последние версии miniShop2 включают в себя замечательный шаблонихатор Fenom, который позволяет вынести всё оформление сниппета в один чанк.

Поэтому с версии 2.4 у корзины всего один чанк:
- **tpl.msCart** - общий чанк корзины

Он содержит в себе всю таблицу, а товары в ней обрабатывает в цикле:
```
{foreach $products as $product}
    {$product | print} <!-- распечатываем все свойства товара для отладки-->
{/foreach}
```
Все нужные данные приходят в массивах, которые нужно разбирать, используя синтаксис Fenom.

При этом чанк для пустой корзины тоже не нужен, так как количество товаров можно проверить очень просто:
```
{if count($products) == 0}
    <!-- сообщение о пустой корзине -->
    {'ms2_cart_is_empty' | lexicon}
{else}
    <!-- вывод товаров -->
{/if}
```

Все подробности о работе сниппетов и их переменных и плейсхолдерах находятся в [соответствующем разделе][2].

### Оформление писем
Для писем используется механизм расширения шаблонов Fenom.

То есть, в комплекте с miniShop2 идёт один чанк `tpl.msEmail` с шаблоном письма по умолчанию, который разбит на смысловые блоки.
Другие письма расширяют этот чанк и меняют нужные им блоки.
- **logo** - логотип магазина со ссылкой на главную страницу
- **title** - заголовок письма
- **products** - таблица заказанные товаров
- **footer** - ссылка на сайте в подвале письма

Это позволяет очень легко модифицировать письма разных статусов заказа.
Например, письмо с новым заказом покупателю выглядит так:
```
{extends 'tpl.msEmail'}

{block 'title'}
    {'ms2_email_subject_new_user' | lexicon : $order}
{/block}

{block 'products'}
    {parent}
    {if $payment_link?}
        <p style="margin-left:20px;{$style.p}">
            {'ms2_payment_link' | lexicon : ['link' => $payment_link]}
        </p>
    {/if}
{/block}
```
Как видите, здесь наследуется основной шаблон, меняется заголовок, а к таблице товаров добавляется ссылка на оплату (если есть).

[![](https://file.modx.pro/files/b/1/c/b1c563c0b075caf2afce7609ac3f15e4s.jpg)](https://file.modx.pro/files/b/1/c/b1c563c0b075caf2afce7609ac3f15e4.png)

Все письма подготавливаются сниппетом [msGetOrder][4].
Подробнее о расширении шаблонов вы можете прочитать в [документации Fenom][3].


## Переход с 2.2 на 2.3

Разработка miniShop 2.3 была отменена& так что смотрите переход на версию 2.4.


[1]: /ru/01_Компоненты/01_pdoTools/03_Парсер.md
[2]: /ru/01_Компоненты/02_miniShop2/02_Сниппеты
[3]: https://github.com/fenom-template/fenom/blob/master/docs/ru/tags/extends.md
[4]: /ru/01_Компоненты/02_miniShop2/02_Сниппеты/05_msGetOrder.md